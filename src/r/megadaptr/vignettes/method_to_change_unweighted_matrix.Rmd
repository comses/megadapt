---
title: "A method to change the unweighted supermatrix in the block {risk,environtment}"
author: "Andres Baeza"
date: "May 27, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Equations to implement the double coupling using the rate of change in ponding and flooding from historic mean in the city

## To change the values in the column rainfall 
$rf$.

First, we calculate the rate of change from historical values and we multiply it by the initial weights in the column $rf$ of the environment block of the unweighted supermatrix: 
$$\Delta_{p,t}^{rf} =\frac{\sum pond_{j,t}}{\sum \overline{pond_{j}}} w_{initial}^{p,rf}$$


$$\Delta_{f,t}^{rf} =\frac{\sum flood_{j,t}}{\sum \overline{f_{j}}} w_{initial}^{f,rf},$$


$\forall j \in J$ where $J$ is the total number of census block with rainfall. $\Delta_{f,t}^{rf}$ is the unnormalized new weight in the column rainfall ($rf$) and row flooding ($f$) at time $t$. $w_{initial}^{p,rf}$ and $w_{initial}^{f,rf}$ are the initial values in the unweighted matrix for the column ranfall ($rf$) and row ponding ($p$) and flooding ($f$) respectivelly.
Thus, the new values of the column "precipitation"" in the block {risk, environtment} will be:  

$$w_{new,t+1}^{p,rf}=\frac{\Delta_{p,t}^{rf}}{\Delta_{p,t}^{rf} + \Delta_{f,t}^{rf}}$$

$$w_{new,t+1}^{f,rf}=\frac{\Delta_{f,t}^{rf}}{\Delta_{p,t}^{rf} + \Delta_{f,t}^{rf}}$$
where $w_{new,t}^{p,rf}$ and $w_{new,t}^{f,rf}$ are the new values for time $t+1$ in the column rainfall $rf$ and rows ponding $p$ and flooding $f$ respectivelly.

## To change the values in the colum runoff 
To implement a change in the colum runoff $r$, the calculation only considers the census blocks that are affected by runoff. (The assuption here is that the runoff from one census block from another is neglegable in the areas without runoff).

Let's define $I$ as the set of census block affected by runoff, such that $I \subset J$.

The rante of change will be 
$$\Delta_{p,t}^{r} =\frac{\sum pond_{j,t}}{\sum \overline{pond_{i}}} w_{initial}^{p,r}$$


$$\Delta_{f,t}^{r} =\frac{\sum flood_{i,t}}{\sum \overline{flood_{i}}} w_{initial}^{f,r}$$


